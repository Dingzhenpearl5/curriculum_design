<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教学管理员仪表盘 - 成绩管理教学平台</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            background-color: #f8f9fa;
        }
        .navbar-brand {
            font-weight: bold;
        }
        .sidebar {
            min-height: calc(100vh - 56px); /* Subtract navbar height */
            background-color: #343a40;
            color: white;
        }
        .sidebar a {
            color: rgba(255,255,255,.75);
            text-decoration: none;
            padding: 10px 15px;
            display: block;
        }
        .sidebar a:hover, .sidebar a.active {
            color: white;
            background-color: #495057;
        }
        .sidebar .submenu a {
            padding-left: 30px;
            font-size: 0.9em;
        }
        .main-content {
            padding: 20px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        }
        .schedule-table th, .schedule-table td {
            text-align: center;
            vertical-align: middle;
            height: 60px;
        }
        .schedule-cell {
            background-color: #e3f2fd;
            border-radius: 4px;
            padding: 5px;
            font-size: 0.9em;
        }
        .sortable {
            cursor: pointer;
        }
        .sortable:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>
<body>

<!-- Top Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-secondary">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">教学管理员仪表盘</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i> 管理员
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#">个人设置</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" onclick="logout()">退出登录</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-2 sidebar p-0 collapse d-md-block" id="sidebarMenu">
            <nav class="mt-2">
                <!-- 基础数据管理 (Accordion) -->
                <a href="#submenu-basic" data-bs-toggle="collapse" class="d-flex justify-content-between align-items-center nav-link">
                    <span><i class="bi bi-database"></i> 基础数据管理</span>
                    <i class="bi bi-chevron-down small"></i>
                </a>
                <div class="collapse show submenu" id="submenu-basic">
                    <a href="#" class="nav-link active" data-target="class-section">班级管理</a>
                    <a href="#" class="nav-link" data-target="student-section">学生管理</a>
                    <a href="#" class="nav-link" data-target="course-section">课程管理</a>
                    <a href="#" class="nav-link" data-target="teacher-section">教师管理</a>
                    <a href="#" class="nav-link" data-target="plan-section">开课计划</a>
                </div>

                <!-- 成绩审核 -->
                <a href="#" class="nav-link" data-target="score-section">
                    <i class="bi bi-check-circle"></i> 成绩审核与发布
                </a>
                
                <!-- 退出 -->
                <a href="#" class="nav-link text-danger mt-5" onclick="logout()">
                    <i class="bi bi-box-arrow-right"></i> 退出系统
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="col-md-10 main-content">
            
            <!-- 1. 班级管理 -->
            <div id="class-section" class="content-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>班级管理</h2>
                    <button class="btn btn-primary" onclick="openClassModal()">+ 新增班级</button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table class="table table-hover" id="class-table">
                            <thead>
                                <tr>
                                    <th class="sortable" onclick="handleSort('class-table', 'id')">ID <i class="bi bi-arrow-down-up"></i></th>
                                    <th class="sortable" onclick="handleSort('class-table', 'name')">班级名称 <i class="bi bi-arrow-down-up"></i></th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 2. 学生管理 -->
            <div id="student-section" class="content-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>学生管理</h2>
                    <div class="d-flex gap-2">
                        <input type="text" class="form-control" placeholder="搜索学生..." onkeyup="handleSearch('student-table', this.value)">
                        <button class="btn btn-primary text-nowrap" onclick="openStudentModal()">+ 新增学生</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table class="table table-hover" id="student-table">
                            <thead>
                                <tr>
                                    <th class="sortable" onclick="handleSort('student-table', 'username')">学号 <i class="bi bi-arrow-down-up"></i></th>
                                    <th class="sortable" onclick="handleSort('student-table', 'name')">姓名 <i class="bi bi-arrow-down-up"></i></th>
                                    <th class="sortable" onclick="handleSort('student-table', 'className')">班级 <i class="bi bi-arrow-down-up"></i></th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 3. 课程管理 -->
            <div id="course-section" class="content-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>课程管理</h2>
                    <button class="btn btn-primary" onclick="openCourseModal()">+ 新增课程</button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table class="table table-hover" id="course-table">
                            <thead>
                                <tr>
                                    <th>课程代码</th>
                                    <th>课程名称</th>
                                    <th>学分</th>
                                    <th>所属院系</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 4. 教师管理 -->
            <div id="teacher-section" class="content-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>教师管理</h2>
                    <button class="btn btn-primary" onclick="openTeacherModal()">+ 新增教师</button>
                </div>
                <div class="card">
                    <div class="card-body">
                        <table class="table table-hover" id="teacher-table">
                            <thead>
                                <tr>
                                    <th>工号</th>
                                    <th>姓名</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 5. 开课计划 -->
            <div id="plan-section" class="content-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>开课计划管理</h2>
                    <button class="btn btn-primary" onclick="openPlanModal()">+ 新增开课计划</button>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">计划列表</div>
                    <div class="card-body">
                        <table class="table table-hover" id="plan-table">
                            <thead>
                                <tr>
                                    <th>课程</th>
                                    <th>授课教师</th>
                                    <th>学期</th>
                                    <th>教室</th>
                                    <th>上课时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">本学期课表预览 (2024-2025-1)</div>
                    <div class="card-body">
                        <table class="table table-bordered schedule-table" id="schedule-table">
                            <thead>
                                <tr class="table-light">
                                    <th>节次 / 星期</th>
                                    <th>周一</th>
                                    <th>周二</th>
                                    <th>周三</th>
                                    <th>周四</th>
                                    <th>周五</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 6. 成绩审核 -->
            <div id="score-section" class="content-section" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>成绩审核与发布</h2>
                    <button class="btn btn-outline-secondary" onclick="exportAllScores()">导出所有报表</button>
                </div>
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> 红色背景行表示数据异常（优秀率>60% 或 及格率<70%），请重点审核。
                </div>
                <div class="card">
                    <div class="card-body">
                        <table class="table table-hover align-middle" id="score-audit-table">
                            <thead>
                                <tr>
                                    <th>课程名称</th>
                                    <th>授课教师</th>
                                    <th>学生人数</th>
                                    <th>平均分</th>
                                    <th>优秀率</th>
                                    <th>及格率</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Modals -->

<!-- Class Modal -->
<div class="modal fade" id="classModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">编辑班级</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="classForm">
                    <input type="hidden" id="classId">
                    <div class="mb-3">
                        <label class="form-label">班级名称</label>
                        <input type="text" class="form-control" id="className" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveClass()">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- Student Modal -->
<div class="modal fade" id="studentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">编辑学生</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="studentForm">
                    <input type="hidden" id="studentId">
                    <div class="mb-3">
                        <label class="form-label">学号 (Username)</label>
                        <input type="text" class="form-control" id="studentUsername" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">姓名</label>
                        <input type="text" class="form-control" id="studentName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">所属班级</label>
                        <select class="form-select" id="studentClassId" required></select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveStudent()">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- Teacher Modal -->
<div class="modal fade" id="teacherModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">编辑教师</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="teacherForm">
                    <input type="hidden" id="teacherId">
                    <div class="mb-3">
                        <label class="form-label">工号 (Username)</label>
                        <input type="text" class="form-control" id="teacherUsername" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">姓名</label>
                        <input type="text" class="form-control" id="teacherName" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveTeacher()">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- Course Modal -->
<div class="modal fade" id="courseModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">编辑课程</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="courseForm">
                    <input type="hidden" id="courseId">
                    <div class="mb-3">
                        <label class="form-label">课程代码</label>
                        <input type="text" class="form-control" id="courseCode" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">课程名称</label>
                        <input type="text" class="form-control" id="courseName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">学分</label>
                        <input type="number" class="form-control" id="courseCredits" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">所属院系</label>
                        <input type="text" class="form-control" id="courseDept" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveCourse()">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- Plan Modal -->
<div class="modal fade" id="planModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">编辑开课计划</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="planForm">
                    <input type="hidden" id="planId">
                    <div class="mb-3">
                        <label class="form-label">选择课程</label>
                        <select class="form-select" id="planCourseId" required></select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">授课教师</label>
                        <select class="form-select" id="planTeacherId" required></select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">学期</label>
                        <input type="text" class="form-control" id="planSemester" value="2024-2025-1" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">教室</label>
                        <input type="text" class="form-control" id="planClassroom" required>
                    </div>
                    <div class="row mb-3">
                        <label class="form-label">上课时间</label>
                        <div class="col">
                            <select class="form-select" id="planDay">
                                <option value="周一">周一</option>
                                <option value="周二">周二</option>
                                <option value="周三">周三</option>
                                <option value="周四">周四</option>
                                <option value="周五">周五</option>
                            </select>
                        </div>
                        <div class="col">
                            <select class="form-select" id="planSlot">
                                <option value="1-2节">1-2节</option>
                                <option value="3-4节">3-4节</option>
                                <option value="5-6节">5-6节</option>
                                <option value="7-8节">7-8节</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="savePlan()">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- Score Detail Modal -->
<div class="modal fade" id="scoreDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">成绩明细</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3 d-flex justify-content-between">
                    <h6 id="scoreDetailTitle"></h6>
                    <span class="badge bg-warning text-dark" id="scoreDetailWarning" style="display:none">存在异常波动学生</span>
                </div>
                <table class="table table-sm table-bordered" id="score-detail-table">
                    <thead>
                        <tr>
                            <th>学号</th>
                            <th>姓名</th>
                            <th>平时成绩</th>
                            <th>期末成绩</th>
                            <th>总评</th>
                            <th>异常检测</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/data.js"></script>
<script src="js/admin.js"></script>
</body>
</html>
